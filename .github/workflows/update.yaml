name: Update hit.lib.unb.ca

on:
  workflow_dispatch:

jobs:
  update-drupal:
    name: Update Drupal
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: unb-libraries/install-dockworker-composite-action@v2
      - name: Remove Dockworker-Installed git Hooks
        run: rm -f .git/hooks/commit-msg .git/hooks/pre-commit
      - name: Update Drupal and Dependencies
        shell: 'script -q -e -c "bash {0}"'
        run: vendor/bin/dockworker update
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.UNBLIBBOT_PAT_TOKEN }}
          commit-message: Update Drupal and Dependencies
          committer: UNB Libraries CodeBot <libsystems@unb.ca>
          author: UNB Libraries CodeBot <libsystems@unb.ca>
          signoff: false
          branch: drupal-updates
          delete-branch: true
          title: 'Drupal Updates'
          body: |
            Auto-generated by [drupal-update-action][1]

            [1]: https://github.com/unb-libraries/dockworker-drupal
          labels: |
            automated pr
          draft: false
